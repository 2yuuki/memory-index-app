<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Memory Index</title>
  <link rel="icon" href="assets/UI items/logo.svg" type="image/x-icon" />
  <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/p5.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://use.typekit.net/ptv6ncb.css">
</head>
<body>

<div id="boot-screen"></div>
<div class="noise-overlay"></div>
<div id="app-container">

  <div class="app-sidebar">
    <div class="sidebar-bg-rotated"></div>
    <div class="sidebar-tab active" data-tab="tab-thoughts" onclick="switchTab('tab-thoughts')" data-tooltip="Tab 1: Write and collect your thoughts.">1. Thoughts</div>
    <div class="sidebar-tab" data-tab="tab-image-proc" onclick="switchTab('tab-image-proc')" data-tooltip="Tab 2: Process images into ASCII art.">2. Image Processor</div>
    <div class="sidebar-tab" data-tab="tab-sketch" onclick="switchTab('tab-sketch')" data-tooltip="Tab 3: Sketch freely with ASCII characters.">3. ASCII Sketch</div>
    <div class="sidebar-tab" data-tab="tab-index" onclick="switchTab('tab-index')" data-tooltip="Tab 4: Arrange your memory diagram.">4. Memory Diagram</div>
  </div>

  <div class="layout-column">
    <!-- TOP BAR -->
    <div class="top-bar">
      <div class="top-bar-overlay"></div>

      <div class="brand-pill">
      </div>

      <div class="tabs-container">
        <div class="tab-btn active" onclick="switchSidebar('intro')">I. Introduction</div>
        <div class="tab-btn" onclick="switchSidebar('tools')" data-tooltip="Click to enter Tool System">II. Tool Tab</div>
      </div>

      <div class="top-right-controls"></div>
    </div>

  <!-- INTRO VIEW -->
  <div id="intro-view" class="intro-container">
      <div class="intro-content" style="position: relative; background-color: #fdfbf7; border: 2px solid #0072BC; box-shadow: 10px 10px 0 #0072BC; font-family: 'KK7VCROSDMono', monospace;">
        <div class="paper-lines"></div>
        <div class="margin-line"></div>
        <div style="position: relative; z-index: 1;">

  <img src="assets/UI items/logo.svg" class="intro-logo" alt="Logo">

  <h1 id="intro-title" class="section-title" style="text-align:center;">
    The Memory Index
  </h1>

  <p style="text-align:center; font-family:'KK7VCROSDMono'; color:#182983; line-height:1.6;">
    Creative Process Documentation<br>
    Nguyen Thu Trang – s3926717<br>
    COMM2754 Major Project, Semester C 2025<br>
    School of Communication and Design, RMIT University Vietnam
  </p>

  <div class="divider"></div>

  <div style="max-width:1200px; margin:0 auto;">

    <h2 style="color:#0072BC; font-size:22px; margin-top:30px; margin-bottom:10px; border-bottom:2px solid #0072BC; padding-bottom:5px;">I. Project Overview</h2>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">1. Concept Statement</h3>
    <p class="intro-desc">
      I want to make a major project that would inspire people to embrace their past emotions
      and core memories so they can understand themselves better. Since I notice that we are
      living in a society that tells us to ignore the strong emotions in order to win in life,
      but it’s not true. From my own experience, respecting what we feel helps us grow.
    </p>

    <div class="divider"></div>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">2. Abstract</h3>
    <p class="intro-desc">
      The Memory Index is a public, web-based interactive platform built with p5.js. The project
      transforms personal memories—written notes, images, and sketches—into printable visual
      artifacts. These outputs take the form of a Memory Index Diagram and an East–West–South–North
      paper fortune-teller. The project explores how net.art aesthetics and computational systems
      can function as tools for emotional reflection.
    </p>

    <p class="intro-desc"><em>Fig 1. My ASCII drawing using my own Memory Index Tool</em></p>

    <div class="divider"></div>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">3. Project Question</h3>
    <p class="intro-desc">
      The guiding research question for this project is:
      <br><br>
      <strong>“How can we embrace our memories through the net.art?”</strong>
      <br><br>
      Rather than offering answers or prescriptions, the project investigates how net.art systems—
      such as diagrams, ASCII graphics, and browser-native interactions—can translate emotional
      states into readable and revisit-able forms.
    </p>

    <div class="divider"></div>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">4. Target Audience</h3>
    <p class="intro-desc">
      The primary audience for The Memory Index is Vietnamese users aged 18–30, though the platform
      remains open to everyone. This audience is nostalgic for Vietnamese pop culture from the
      2000s–2010s and enjoys journaling, DIY making, and visual experimentation. Many users dislike
      traditional text-only journaling and prefer playful, generative tools that allow reflection
      in short, late-night sessions.
    </p>

    <div class="divider"></div>

    <h2 style="color:#0072BC; font-size:22px; margin-top:30px; margin-bottom:10px; border-bottom:2px solid #0072BC; padding-bottom:5px;">II. Scope History and Rationale</h2>
    <p class="intro-desc">
      The project initially began as a web-based 3D interactive character representing a universal
      childhood self. Users would draw onto the character to leave traces of their memories.
      However, the scope was too large, and the interaction did not evoke sufficient emotional
      depth. The project shifted toward journaling as a more effective reflective practice and
      evolved into a web platform that transforms memories into printable artifacts.
    </p>

    <p class="intro-desc">
      <strong>Interactive Flow:</strong><br>
      Goal: Turn individual memories into a shared skin for the kid; at the end, destroy the figure
      to show the “transformation through love.”
    </p>

    <div class="divider"></div>

    <h2 style="color:#0072BC; font-size:22px; margin-top:30px; margin-bottom:10px; border-bottom:2px solid #0072BC; padding-bottom:5px;">III. Methodology</h2>
    <p class="intro-desc">
      The interaction flow of the website is intentionally simple and flexible. Users write down
      their thoughts, upload memory-related images, and optionally sketch using an ASCII painting
      tool. These inputs are archived and processed to generate a Memory Index Diagram and a paper
      fortune-teller, which users can export and print.
    </p>

    <div class="divider"></div>

    <h2 style="color:#0072BC; font-size:22px; margin-top:30px; margin-bottom:10px; border-bottom:2px solid #0072BC; padding-bottom:5px;">IV. Background Research</h2>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">1. Ikigai Theory</h3>
    <p class="intro-desc">
      Ikigai diagrams try to make sense of fuzzy, emotional questions with rational axes (what you
      love / are good at / can be paid for / the world needs). I borrow that spirit—turning affect
      into readable indices—but avoid life prescription; the output here is just gentle hints.
    </p>

    <div class="divider"></div>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">2. Net.art Diagram</h3>
    <p class="intro-desc">
      Works like MTAA’s Simple Net Art Diagram show how a feeling or practice can be explained
      through schematics and data-like flows. This project adapts that move: an ASCII, ECG-style
      trace models inner states as a system you can read and revisit.
    </p>

    <div class="divider"></div>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">
      3. Olia Lialina, <em>My Boyfriend Came Back from the War</em> (1996)
    </h3>
    <p class="intro-desc">
      Lialina’s split-screen, click-to-unfold interaction proves the web browser itself can stage
      time, tension, and revelation. I reuse the progressive disclosure pattern—nested panels
      opened by clicking—but for self-reflection rather than narrative.
    </p>

    <div class="divider"></div>

    <h2 style="color:#0072BC; font-size:22px; margin-top:30px; margin-bottom:10px; border-bottom:2px solid #0072BC; padding-bottom:5px;">V. Creative Practice and Iterative Development</h2>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">1. Week 0–2: Visual Direction and Early Experiments</h3>
    <p class="intro-desc">
      During the early stage of the project, the focus was on establishing a visual direction that
      could balance Vietnamese nostalgic editorial aesthetics with net.art and data-poetic visuals.
      Initial experiments explored typography inspired by Vietnamese student handwriting and early
      layout tests using p5.js. I also began experimenting with image filters such as posterization
      and pixelation to understand how memory images could be transformed into printable textures.
    </p>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">2. Week 3: Personal Reflection and Interaction Testing</h3>
    <p class="intro-desc">
      In Week 3, I began by reflecting on my own core memories through writing. This personal journaling process helped establish an emotional foundation for the project. At the same time, I conducted early interaction tests on the web, including simple sketching mechanics and paper fortune-teller print tests. These experiments revealed that freehand mouse drawing felt uncomfortable and did not encourage reflection.
    </p>

    <div style="background:#f9f9f9; border-left: 4px solid #f75397; padding:20px; margin:20px 0; font-style:italic; font-size:0.95em; line-height: 1.8;">
        <p style="margin:0; white-space:pre-line;">One day I found myself drowning,
        and I don’t know how to wake her up.
        ⎯⎯⎯
        It was as if we were strangers who shared a face.
        She couldn’t recognize my voice, and I didn’t know how to reach her.
        ⎯⎯⎯
        I asked the Forgotten to help me wake that thing inside.
        They refused. They carried the same resentments.

        “Who are you?” they yelled.
        “How can you ask us to help when we also needed help?
        You threw us down here—and now you don’t know how to let us out?
        We are dying together. You and us.”
        ⎯⎯⎯
        “What is the point of living such a damn life?” I wondered.

        I love living when I lie on my grandmother’s legs and she sings the old lullaby.
        The scorching air stings my skin, a humid heat I can’t find anywhere else.

        I love living when I can still sleep in the same room as my dad.
        Every night I kiss his cheek goodnight.
        Morning birds weave a nest outside our window; their voices spark the urge to create—
        to bring a little beauty into the world.

        I love living when my brother carries me on his back.
        I love that feeling—being loved, knowing it, being grateful.

        I love living when I look up at the sky, chasing my friends around the corner of our neighborhood.
        Wind threads through the leaves at just the right speed, drawing tiny patterns from below.
        Sunlight hits my eyes so bright it still shines in memory.

        It was a lot of things.

        So I beg myself:
        don’t rush to forget them.
        Try to wake up again.

        Please.

        Even if it doesn’t work now, even if we fail many times,
        remember: one day we will feel it again—
        the swim against the current, the waking.

        Keep going through every milestone of life.

        I know I can.
        I love you—
        even if I didn’t realize how many hugs you needed.</p>
    </div>

    <div class="divider"></div>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">3. Week 4: Image Processing and Prototype Evaluation</h3>
    <p class="intro-desc">
      Week 4 focused on image-processing techniques and overall UX evaluation. I prototyped a print-emulation workflow where images were broken into shadow, midtone, and highlight layers mapped to CMYK or spot colors. Although watercolor-style effects were explored, performance constraints led to a softer, textured alternative. At this stage, I also critically reviewed the prototype and identified issues with visual noise and unclear user flow.
    </p>

    <div class="divider"></div>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">4. Week 5: ASCII Filter and Visual Identity Refinement</h3>
    <p class="intro-desc">
      In Week 5, I discovered references that combined ASCII threshold techniques with marker-like textures, which strongly resonated with my childhood memories of using school markers. This inspired the development of a marker-like ASCII filter. I also conducted extensive visual mockups in Adobe Illustrator to strengthen the Vietnamese nostalgic identity and refine the balance between net.art aesthetics and cultural familiarity.
    </p>

    <div class="divider"></div>

    <h3 style="color:#333; font-size:18px; margin-top:20px; margin-bottom:5px;">5. Week 6: ASCII Painting Tool and Print Testing</h3>
    <p class="intro-desc">
      Week 6 marked the development of the ASCII painting tool. Instead of freehand drawing, users place ASCII characters into a grid, similar to building with LEGO. Informal user testing with friends showed that this interaction was calming and accessible. Finally, I conducted print tests on student notebook paper, handwriting practice paper, and traditional Vietnamese Dó paper. While Dó paper produced beautiful textures, student notebook paper provided the best balance between clarity and nostalgia.
    </p>

    <div class="divider"></div>

    <h2 style="color:#0072BC; font-size:22px; margin-top:30px; margin-bottom:10px; border-bottom:2px solid #0072BC; padding-bottom:5px;">VI. Reflection and Conclusion</h2>
    <p class="intro-desc">
      The Memory Index does not attempt to solve emotional problems or provide guidance. Instead,
      it offers a slow, playful system for observing memories. By transforming digital reflection
      into printable objects, the project reconnects emotional reflection with touch, nostalgia,
      and imperfection.
    </p>

    <div class="divider"></div>

    <h2 style="color:#0072BC; font-size:22px; margin-top:30px; margin-bottom:10px; border-bottom:2px solid #0072BC; padding-bottom:5px;">VII. References</h2>
    <ul class="intro-desc" style="font-size:13px; line-height:1.6; padding-left: 20px; list-style-type: disc;">
      <li style="margin-bottom: 8px;">Dunne, A & Raby, F 2013, Speculative Everything: Design, Fiction, and Social Dreaming, The MIT Press, Cambridge, MA.</li>
      <li style="margin-bottom: 8px;">Lialina, O 1996, My Boyfriend Came Back from the War, online artwork, viewed 5 November 2025, http://www.teleportacia.org/war/.</li>
      <li style="margin-bottom: 8px;">Lozano-Hemmer, R 2006– , Pulse series, installation, viewed 5 November 2025, https://www.lozano-hemmer.com/pulse_series.php.</li>
      <li style="margin-bottom: 8px;">Lupi, G 2017, ‘Data Humanism: The Revolution will be Visualized’, Print Magazine, viewed 5 November 2025, https://www.printmag.com/featured/giorgia-lupi-data-humanism/.</li>
      <li style="margin-bottom: 8px;">Lupton, D 2016, The Quantified Self, Polity Press, Cambridge.</li>
      <li style="margin-bottom: 8px;">Picard, R W 1997, Affective Computing, The MIT Press, Cambridge, MA.</li>
      <li style="margin-bottom: 8px;">Reas, C & Fry, B 2007, Processing: A Programming Handbook for Visual Designers and Artists, The MIT Press, Cambridge, MA.</li>
      <li style="margin-bottom: 8px;">Sengers, P, Boehner, K, David, S & Kaye, J 2005, ‘Reflective design’, in Proceedings of the 4th Decennial Conference on Critical Computing: Between Sense and Sensibility (CC ’05), ACM Press, New York, pp. 49–58.</li>
      <li style="margin-bottom: 8px;">JODI 1995– , JODI.org, online artworks, viewed 5 November 2025, http://wwwwwwwww.jodi.org/.</li>
      <li style="margin-bottom: 8px;">MTAA (M.River & T.Whid Art Associates) 1997, ‘Simple Net Art Diagram’, Rhizome Anthology, viewed 5 November 2025, https://anthology.rhizome.org/simple-net-art-diagram.</li>
      <li style="margin-bottom: 8px;">Connor, M 2015, ‘Notes on the Definition of Net Art’, Rhizome, 17 July, viewed 5 November 2025, https://rhizome.org/editorial/2015/jul/17/notes-definition-net-art/.</li>
      <li style="margin-bottom: 8px;">Mogi, K 2017, The Little Book of Ikigai: The Essential Japanese Way to Finding Your Purpose in Life, Quercus, London.</li>
      <li style="margin-bottom: 8px;">Winn, M 2014, ‘What is your ikigai?’, MarcWinn.com (blog), viewed 5 November 2025, https://marcwinn.com/ikigai/.</li>
      <li style="margin-bottom: 8px;">Sài Gòn Giải Phóng (n.d.) ‘Zing Me – tự hào mạng xã hội Việt’, Sài Gòn Giải Phóng Online, viewed 20 November 2025, https://www.sggp.org.vn/zing-me-tu-hao-mang-xa-hoi-viet-post233795.html.</li>
      <li style="margin-bottom: 8px;">MarketingAI (n.d.) ‘Zing Me: mạng xã hội chưa kịp tỏa sáng đã bị đối thủ “quật” cho không thể ngóc đầu’, MarketingAI, viewed 20 November 2025, https://marketingai.vn/zing-me-mang-xa-hoi-chua-kip-toa-sang-da-bi-doi-thu-quat-cho-khong-the-ngoc-dau-19467600.htm.</li>
      <li style="margin-bottom: 8px;">Thế giới của Quỳnh (2018) ‘Sự sụp đổ của đế chế Zing Me’, WordPress blog, 13 July, viewed 20 November 2025, https://thegioicuaquynh.wordpress.com/2018/07/13/su-sup-do-cua-de-che-zing-me/.</li>
      <li style="margin-bottom: 8px;">Marketing24h (n.d.) ‘Zing Me (tổng quan)’, Marketing24h, viewed 20 November 2025, https://marketing24h.vn/zing-me-2/.</li>
      <li style="margin-bottom: 8px;">YouTube (n.d.) ‘[Video về Zing Me]’, YouTube video, viewed 20 November 2025, https://www.youtube.com/watch?v=1EkFFQ0Kd2I.</li>
      <li style="margin-bottom: 8px;">YouTube (n.d.) ‘[Clip/Phóng sự liên quan Zing Me]’, YouTube video, viewed 20 November 2025, https://www.youtube.com/watch?v=QO_u2ip5-Dw&t=198s.</li>
      <li style="margin-bottom: 8px;">Báo Quân đội Nhân dân (n.d.) ‘Đề cương văn hóa Việt Nam: Những giá trị cốt lõi’, QDND Online, viewed 19 November 2025, https://www.qdnd.vn/van-hoa/doi-song/de-cuong-van-hoa-viet-nam-nhung-gia-tri-cot-loi-719015.</li>
      <li style="margin-bottom: 8px;">Tech in Asia (n.d.) ‘Zing Me vs Facebook in Vietnam’, Tech in Asia, viewed 20 November 2025, https://www.techinasia.com/zing-me-facebook-vietnam.</li>
      <li style="margin-bottom: 8px;">Yootek (n.d.) ‘Zing Me – Mạng xã hội’, Yootek, viewed 20 November 2025, https://yootek.vn/zing-me-mang-xa-hoi/.</li>
      <li style="margin-bottom: 8px;">Thương mại Trường Xưa (n.d.) ‘Thương mại Trường Xưa (trang chủ)’, website, viewed 18 November 2025, https://thuongmaitruongxua.vn/.</li>
      <li style="margin-bottom: 8px;">OpenProcessing n.d., ‘Sketch 2655050’, OpenProcessing, viewed 15 November 2025, https://openprocessing.org/sketch/2655050</li>
      <li style="margin-bottom: 8px;">Glyph Drawing Club n.d., ‘Amiga ASCII Art’, blog post, viewed 20 November 2025, https://blog.glyphdrawing.club/amiga-ascii-art/</li>
      <li style="margin-bottom: 8px;">YouTube n.d., ‘Video (ID: W1zKu3fDQR8)’, YouTube, viewed 13 November 2025, https://www.youtube.com/watch?v=W1zKu3fDQR8</li>
      <li style="margin-bottom: 8px;">HLNET n.d., ‘ASCII Automata’, Neocities, viewed 16 November 2025, https://hlnet.neocities.org/ascii-automata/</li>
      <li style="margin-bottom: 8px;">Nicup n.d., ‘Works’, nicup.art, viewed 16 November 2025, https://nicup.art/works/</li>
    </ul>

    </div>
  </div>
</div>


  </div>

  <div class="app-body" id="main-app-body" style="display:none;">

  <!-- TAB 1: THOUGHTS -->
  <div class="workspace active" id="tab-thoughts">
    <div class="panel-left ribbon ribbon-green" data-ribbon="1. Thoughts">
      <div class="section-title">1/ Write down your thoughts here</div>
      <textarea id="inpThought" class="retro-input" placeholder="Type thoughts..."></textarea>
      <button class="btn-retro" id="btnCreateCard" data-tooltip="Add your thought to the memory archive.">+ add thoughts</button>
    </div>
    <div class="panel-center">
      <!-- Empty or decorative center for thoughts -->
    </div>
  </div>

  <!-- TAB 2: IMAGE PROCESSOR -->
  <div class="workspace" id="tab-image-proc">
    <div class="panel-left ribbon ribbon-green" data-ribbon="2. Processor">
      <div class="section-title">2/ Image Processor</div>
      <!-- Restore hidden elements for compatibility with ui-binding.js -->
      <div id="preview-area" style="display:none;"></div>
      <button id="btnLoadImage" style="display:none;"></button>
      <input type="file" id="fileIn" hidden data-tooltip="Upload an image to process." />

      <div class="section-title">ASCII Options</div>
      <div class="mini-row">
        <span>Ink Type</span>
        <select id="selColorMode" class="retro-input" style="width:120px; height:24px; padding:0;">
          <option value="cmyk">CMYK Marker</option>
          <option value="stabilo">Stabilo Marker</option>
          <option value="mono">Monochrome</option>
          <option value="dither">Dither</option>
          <option value="image">Original</option>
        </select>
      </div>
      <div class="mini-row">
        <span>Pattern</span>
        <input type="range" id="cfgWeight" min="0.5" max="3" step="0.1" value="2.5">
      </div>
      <div class="mini-row">
        <span>Preset</span>
        <select id="selAsciiPreset" class="retro-input" style="width:120px; height:24px; padding:0;"></select>
      </div>
      <div class="mini-row">
        <span>Threshold</span>
        <input type="range" id="cfgDensity" min="0.1" max="2" step="0.1" value="1.5">
      </div>
      
      <div class="mini-row">
        <label class="chk"><input type="checkbox" id="chkInvert" checked> Invert Chars</label>
        <label class="chk"><input type="checkbox" id="chkShowSrc"> Show Source</label>
        <label class="chk"><input type="checkbox" id="chkAnimate"> Animate</label>
      </div>

      <button class="btn-retro btn-wide" id="cmykSaveBtn" data-tooltip="Save processed image to library.">+ add to library</button>
      <button class="btn-retro btn-wide" id="btnSavePNG" style="margin-top:6px;" data-tooltip="Download as PNG image.">download image</button>
    </div>

    <div class="panel-center">
      <div class="paper-sheet paper-a4" style="height:75%; width:auto; aspect-ratio:297/210; margin:auto; transform:none; border:1px solid #000;">
        <div id="input-canvas-holder" class="canvas-holder">
          <div class="placeholder-text">Drop Image Here</div>
        </div>
      </div>
    </div>
  </div>

  <!-- TAB 3: SKETCH -->
  <div class="workspace" id="tab-sketch">
    <!-- Panel 1: Main Tools -->
    <div id="sketch-main-tools" class="floating-panel">
      <div class="panel-header">
        <span>Tools</span>
        <button class="panel-minimize-btn"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIyIiB2aWV3Qm94PSIwIDAgMTAgMiI+PHJlY3Qgd2lkdGg9IjEwIiBoZWlnaHQ9IjIiIGZpbGw9IiNmZmYiLz48L3N2Zz4=" class="pixel-icon" style="width:10px;height:2px;background:#fff;"></button>
      </div>
      <div class="panel-content" style="padding:10px; overflow-y:auto;">
        <div class="tools-grid">
          <button class="btn-retro" id="btnPencil" data-tooltip="Draw with selected character."> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBmaWxsPSIjMDAwIiBkPSJNMTEgMkwxMyA0TDEwIDdMNyA1TDExIDJaTTYgNkw5IDlMNCAxNEgyVjEyTDYgNloiLz48L3N2Zz4=" class="pixel-icon"> Pencil</button>
          <button class="btn-retro" id="btnEraser" data-tooltip="Erase characters."> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBmaWxsPSIjMDAwIiBkPSJNNSAyTDExIDhMMTQuNSA0LjVMOC41IDJINVpNNSA0TDggN0w2IDlMMyA2TDUgNFoiLz48L3N2Zz4=" class="pixel-icon"> Eraser</button>
          <button class="btn-retro" id="btnFill" data-tooltip="Fill area with character."> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBmaWxsPSIjMDAwIiBkPSJNMSA0TDMgMTJIOS41TDEyIDRIMVpNMiA1SDExTDkuNSAxMUgzLjVMMiA1WiIvPjwvc3ZnPg==" class="pixel-icon"> Bucket</button>
          <button class="btn-retro" id="btnClearSketch" data-tooltip="Clear the entire canvas."> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBmaWxsPSIjMDAwIiBkPSJNNSAxSDExVjJIMUMxVjNIMVYySDVWMVpNMiA0SDE0VjE1SDJWNFpNMCA1VjEwSDFWNUgwWk0xNSA1VjEwSDE2VjVIMTVaIi8+PC9zdmc+" class="pixel-icon"> Clear</button>
        </div>
      </div>
    </div>

    <!-- Panel 2: Patterns -->
    <div id="sketch-patterns-panel" class="floating-panel" style="top:220px;">
      <div class="panel-header">
        <span>Patterns</span>
        <button class="panel-minimize-btn"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIyIiB2aWV3Qm94PSIwIDAgMTAgMiI+PHJlY3Qgd2lkdGg9IjEwIiBoZWlnaHQ9IjIiIGZpbGw9IiNmZmYiLz48L3N2Zz4=" class="pixel-icon" style="width:10px;height:2px;background:#fff;"></button>
      </div>
      <div class="panel-content" style="padding:10px; overflow-y:auto;">
        <div id="sketch-palette" class="palette-grid"></div>
      </div>
    </div>

    <!-- Panel 3: Ink -->
    <div id="sketch-ink-panel" class="floating-panel" style="top:440px;">
      <div class="panel-header">
        <span>Ink</span>
        <button class="panel-minimize-btn"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIyIiB2aWV3Qm94PSIwIDAgMTAgMiI+PHJlY3Qgd2lkdGg9IjEwIiBoZWlnaHQ9IjIiIGZpbGw9IiNmZmYiLz48L3N2Zz4=" class="pixel-icon" style="width:10px;height:2px;background:#fff;"></button>
      </div>
      <div class="panel-content" style="padding:10px; overflow-y:auto;">
        <div id="sketch-colors" class="palette-grid palette-ink"></div>
      </div>
    </div>

    <div style="position:relative; width:100%; height:100%; overflow:auto; background:#d0d0d0;">
      <div id="sketch-canvas-holder" style="padding: 20px;"></div>
      <div class="zoom-float" style="position:absolute; right:20px; bottom:20px; top:auto; transform:none;">
        <button class="btn-zoom" id="btnSketchZoomOut">-</button>
        <span id="sketch-zoom-val" class="zoom-text">100%</span>
        <button class="btn-zoom" id="btnSketchZoomIn">+</button>
      </div>
    </div>
  </div>

  <!-- TAB 4: INDEX -->
  <div class="workspace" id="tab-index">
    <div id="layout-tools-panel" class="floating-panel">
      <div class="panel-header">
        <span>Tools</span>
        <button class="panel-minimize-btn"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIyIiB2aWV3Qm94PSIwIDAgMTAgMiI+PHJlY3Qgd2lkdGg9IjEwIiBoZWlnaHQ9IjIiIGZpbGw9IiNmZmYiLz48L3N2Zz4=" class="pixel-icon" style="width:10px;height:2px;background:#fff;"></button>
      </div>
      <div class="panel-content" style="padding:10px; overflow-y:auto;">
        <div id="layer-controls"></div>
        <div class="section-title" style="margin-top:10px;">Layers</div>
        <div id="layer-list" class="layer-list"></div>
      </div>
    </div>

    <div class="panel-center" style="flex-direction:column; justify-content:flex-start; overflow:auto; padding-top:20px; align-items:flex-start;">
      <div class="artboard-wrapper">
        <div class="paper-sheet paper-a4 fixed-a4">
          <div id="layout-canvas-holder" style="width:100%; height:100%; background-color: #444;"></div>
        </div>
      </div>
    </div>
  </div>

  
  </div><!-- end app-body -->
  </div><!-- end layout-column -->
  
  <div id="floating-tooltip"></div>

  <!-- GLOBAL LIBRARY (Pinned) -->
  <div id="global-lib-btn" onclick="toggleGlobalLibrary()" data-tooltip="Open Memory Archive.">LIBRARY</div>
  <div id="global-lib-panel">
    <div class="section-title">Memories Archieve</div>
    <div id="lib-grid" class="lib-grid"></div>
  </div>

  <!-- MUSIC PLAYER WIDGET -->
  <div id="music-player-widget" class="music-widget" data-tooltip="Background Music Player.">
    <div class="music-header">
      <span><span class="music-icon">♫</span> Music Player</span>
      <button id="btn-toggle-music" class="btn-mini" data-tooltip="Minimize/Maximize player."><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIyIiB2aWV3Qm94PSIwIDAgMTAgMiI+PHJlY3Qgd2lkdGg9" class="pixel-icon" style="width:10px;height:2px;background:#fff;"></button>
    </div>
    <div id="music-content" class="music-content">
      <input type="text" id="music-url-input" class="retro-input" placeholder="Paste YouTube / Spotify Link..." style="font-size:10px; padding:6px;" data-tooltip="Paste YouTube or Spotify link here.">
      <button id="btn-play-music" class="btn-retro" style="font-size:10px; padding:4px;" data-tooltip="Load and play track.">Load Track</button>
      <div id="music-embed-container" style="margin-top:4px; min-height:0;"></div>
    </div>
  </div>

  <!-- THOUGHT CARD MODAL -->
  <div id="thought-card-modal" class="modal-overlay" style="display:none;" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
      <img id="thought-card-img" src="" alt="Thought Card" style="display:none;">
      <div id="thought-card-html" class="thought-card-html" style="display:none;">
        <div class="paper-lines"></div>
        <div class="margin-line"></div>
        <div id="thought-card-text-content" class="card-text"></div>
        <div id="thought-card-date" class="card-date"></div>
      </div>
      <div style="display:flex; gap:10px; margin-top:10px;">
        <button id="btn-delete-card" class="btn-retro" style="width: auto; padding: 8px 20px; background-image:none; background-color:#e74c3c; color:white; border-color:#c0392b;">Delete</button>
        <button class="btn-retro" style="width: auto; padding: 8px 20px;" onclick="document.getElementById('thought-card-modal').style.display='none'">Close</button>
      </div>
    </div>
  </div>

  <!-- TOAST NOTIFICATION -->
  <div id="toast-notification" class="toast-notification">Saved</div>

</div>

<script src="sketch.js"></script>
<script src="cmyk-ascii-effect.js"></script>
<script src="ui-binding.js"></script>
<script>
  // Tự động sửa lỗi SVG không giãn (stretch) bằng cách thêm preserveAspectRatio="none"
  async function fixSvgStretch(selector, url) {
    try {
      const resp = await fetch(url);
      if (!resp.ok) return;
      let svgText = await resp.text();
      
      // Thêm thuộc tính preserveAspectRatio="none" để cho phép giãn hình
      if (svgText.includes('<svg')) {
        if (svgText.includes('preserveAspectRatio')) {
          svgText = svgText.replace(/preserveAspectRatio="[^"]*"/, 'preserveAspectRatio="none"');
        } else {
          svgText = svgText.replace('<svg', '<svg preserveAspectRatio="none"');
        }
        const encoded = encodeURIComponent(svgText).replace(/'/g, '%27').replace(/\(/g, '%28').replace(/\)/g, '%29');
        document.querySelectorAll(selector).forEach(el => {
          el.style.backgroundImage = `url("data:image/svg+xml;charset=utf-8,${encoded}")`;
        });
      }
    } catch (e) { console.warn('SVG Fix skipped (needs local server):', e); }
  }
  // Áp dụng fix cho top-bar và panel-center
  //fixSvgStretch('.top-bar', 'assets/UI%20items/top-bar.svg');
  //fixSvgStretch('.panel-center', 'assets/UI%20items/panel-center.svg');
  //fixSvgStretch('.panel-left', 'assets/UI%20items/panel-left.svg');
  //fixSvgStretch('.sidebar-bg-rotated', 'assets/UI%20items/top-bar.svg');

  // Sidebar Switch Logic
  // --- BOOT SEQUENCE ---
  document.addEventListener('DOMContentLoaded', () => {
      const bootScreen = document.getElementById('boot-screen');
      if(bootScreen) {
        const bootLines = [
            "MEM_IDX BIOS v1.0.4",
            "Copyright (C) 2024 Memory Systems Inc.",
            " ",
            "Checking RAM... 640K OK",
            "Loading modules...",
            " > core.sys",
            " > graphics.drv",
            " > audio.lib",
            "Initializing UI...",
            "Mounting virtual volumes...",
            "Done.",
            " ",
            "Starting session..."
        ];

        let delay = 0;
        bootLines.forEach((line, index) => {
            delay += Math.random() * 50 + 20;
            setTimeout(() => {
                const p = document.createElement('div');
                p.className = 'boot-line';
                p.innerText = line;
                bootScreen.appendChild(p);
                bootScreen.scrollTop = bootScreen.scrollHeight;
                if (index === bootLines.length - 1) {
                    const cursor = document.createElement('span');
                    cursor.className = 'cursor-blink';
                    bootScreen.appendChild(cursor);
                }
            }, delay);
        });

        setTimeout(() => {
            bootScreen.style.transition = 'opacity 0.5s ease-out';
            bootScreen.style.opacity = '0';
            setTimeout(() => {
                bootScreen.style.display = 'none';
            }, 500);
        }, delay + 500);
      }
  });

  // --- INTRO DARK MODE LOGIC ---
  function setupIntroDarkMode() {
    const content = document.querySelector('.intro-content');
    if(!content) return;

    let isDarkMode = false;
    const toggleBtn = document.createElement('button');
    toggleBtn.innerText = 'DARK MODE';
    Object.assign(toggleBtn.style, {
        position: 'absolute',
        top: '20px',
        right: '20px',
        background: '#333',
        color: '#fff',
        border: 'none',
        padding: '8px 15px',
        cursor: 'pointer',
        fontFamily: 'inherit',
        fontWeight: 'bold',
        zIndex: '10'
    });

    toggleBtn.onclick = () => {
        isDarkMode = !isDarkMode;
        if(isDarkMode) {
            content.style.backgroundColor = '#1a1a1a';
            toggleBtn.innerText = 'LIGHT MODE';
            toggleBtn.style.background = '#eee';
            toggleBtn.style.color = '#111';
            
            const lines = content.querySelectorAll('.paper-lines, .margin-line');
            lines.forEach(e => e.style.display = 'none');
            
            content.querySelectorAll('h1, h2').forEach(e => {
                e.dataset.oc = e.style.color; e.style.color = '#66b3ff';
                if(e.style.borderBottomColor) { e.dataset.ob = e.style.borderBottomColor; e.style.borderBottomColor = '#66b3ff'; }
            });
            content.querySelectorAll('h3').forEach(e => {
                e.dataset.oc = e.style.color; e.style.color = '#ccc';
            });
            content.querySelectorAll('p, li, strong, .intro-desc').forEach(e => {
                e.dataset.oc = e.style.color; e.style.color = '#ddd';
            });
        } else {
            content.style.backgroundColor = '#fdfbf7';
            toggleBtn.innerText = 'DARK MODE';
            toggleBtn.style.background = '#333';
            toggleBtn.style.color = '#fff';
            
            const lines = content.querySelectorAll('.paper-lines, .margin-line');
            lines.forEach(e => e.style.display = '');
            
            content.querySelectorAll('h1, h2, h3, p, li, strong, .intro-desc').forEach(e => {
                if(e.dataset.oc !== undefined) e.style.color = e.dataset.oc;
                if(e.dataset.ob !== undefined) e.style.borderBottomColor = e.dataset.ob;
            });
        }
    };

    content.appendChild(toggleBtn);
  }

  function playTypewriter() {
    const titleEl = document.getElementById('intro-title');
    if(!titleEl) return;
    
    // Reset cursor visibility at start
    titleEl.classList.add('typewriter-cursor');

    const text = "Index of Remembering";
    titleEl.innerText = ""; // Clear initial text
    
    let i = 0;
    function typeWriter() {
      if (i < text.length) {
        titleEl.innerText += text.charAt(i);
        i++;
        setTimeout(typeWriter, 100); // Speed: 100ms per char
      } else {
        // Remove cursor when typing finishes
        titleEl.classList.remove('typewriter-cursor');
      }
    }
    setTimeout(typeWriter, 100);
  }

  window.switchSidebar = function(mode) {
    const introView = document.getElementById('intro-view');
    const appBody = document.getElementById('main-app-body');
    const tabs = document.querySelectorAll('.top-bar .tab-btn');
    const appSidebar = document.querySelector('.app-sidebar');

    if (mode === 'intro') {
      introView.style.display = 'flex';
      appBody.style.display = 'none';
      if(appSidebar) {
        appSidebar.style.display = ''; /* Xóa inline style cũ nếu có */
        appSidebar.classList.add('hidden');
      }
      
      tabs.forEach(t => {
        if(t.textContent.includes('Introduction')) {
          t.classList.add('active');
          t.classList.remove('disabled-tab');
        } else {
          t.classList.remove('active');
        }
      });
      
      
      // Replay Typewriter Effect
      playTypewriter();

    } else {
      introView.style.display = 'none';
      appBody.style.display = 'flex';
      if(appSidebar) {
        appSidebar.style.display = ''; /* Xóa inline style cũ nếu có */
        appSidebar.classList.remove('hidden');
      }
      tabs.forEach(t => {
        if(t.textContent.includes('Tool')) t.classList.add('active');
        else t.classList.remove('active');
        t.classList.remove('disabled-tab'); // Enable all top tabs
      });
      
      // Auto-switch to Tab 1 (Thoughts)
      if(window.switchTab) window.switchTab('tab-thoughts');
      
      // Auto-play music when entering Tool Tab
      if(window.playRandomMusic) window.playRandomMusic();
      
    }
  }

  window.duplicateArtboard = function(btn) {
    const wrapper = btn.closest('.artboard-wrapper');
    const clone = wrapper.cloneNode(true);
    
    // Update Name
    const input = clone.querySelector('.artboard-name');
    const currentName = input.value;
    const match = currentName.match(/(\d+)$/);
    if(match) {
      input.value = currentName.replace(/\d+$/, parseInt(match[1]) + 1);
    } else {
      input.value = currentName + " Copy";
    }

    // Update ID to avoid duplicates
    const canvasHolder = clone.querySelector('[id^="layout-canvas-holder"]');
    if(canvasHolder) {
      canvasHolder.id = "layout-canvas-holder-" + Date.now();
    }
    
    // Copy Canvas content if any (in case p5.js or other canvas is used)
    const oldCanvases = wrapper.querySelectorAll('canvas');
    const newCanvases = clone.querySelectorAll('canvas');
    if(oldCanvases.length > 0 && oldCanvases.length === newCanvases.length) {
      oldCanvases.forEach((oldCv, i) => {
        const newCv = newCanvases[i];
        const ctx = newCv.getContext('2d');
        if(ctx) ctx.drawImage(oldCv, 0, 0);
      });
    }

    wrapper.parentNode.insertBefore(clone, wrapper.nextSibling);
  }

  // --- Global Library Toggle ---
  window.toggleGlobalLibrary = function() {
    const btn = document.getElementById('global-lib-btn');
    const panel = document.getElementById('global-lib-panel');
    btn.classList.toggle('active');
    panel.classList.toggle('active');
  }

  // --- Export TXT Function (Moved outside switchSidebar to prevent errors) ---
  const btnSaveTXT = document.getElementById('btnSaveTXT');
  if(btnSaveTXT) {
    btnSaveTXT.addEventListener('click', () => {
      let content = "";
      // 1. Try to get text from DOM (if Show Source is on)
      const pre = document.querySelector('#input-canvas-holder pre');
      if(pre) content = pre.innerText;
      
      // 2. Fallback: Check global variable
      if(!content && window.currentAsciiText) content = window.currentAsciiText;

      if(!content) {
        alert("No ASCII text found. \nTip: Enable 'Show Source' or ensure window.currentAsciiText is set.");
        return;
      }

      const blob = new Blob([content], {type: "text/plain;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "memory_ascii.txt";
      a.click();
      URL.revokeObjectURL(url);
    });
  }

  // --- Typewriter Effect & Init ---
  document.addEventListener('DOMContentLoaded', () => {
    // 1. Initialize State (Intro Active, others disabled)
    switchSidebar('intro');
    
    // 2. Setup Dark Mode for Intro
    setupIntroDarkMode();

    // 3. Intro Scroll "Back to Top" Logic
    const introView = document.getElementById('intro-view');
    const btnIntroTop = document.getElementById('btn-intro-top');
    
    if(introView && btnIntroTop) {
      introView.addEventListener('scroll', () => {
        if(introView.scrollTop > 300) {
          btnIntroTop.style.display = 'block';
        } else {
          btnIntroTop.style.display = 'none';
        }
      });
      
      btnIntroTop.addEventListener('click', () => {
        introView.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }
  });
</script>

</body>
</html>
